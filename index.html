<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>YesPrint | Marketplace + Agent Dashboard (HTML)</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons (Vanilla) -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --safe-b: env(safe-area-inset-bottom, 0px);
    }
    .pb-safe { padding-bottom: calc(0.75rem + var(--safe-b)); }
    .animate-fade-in { animation: fadeIn .35s ease-out both; }
    .animate-fade-in-up { animation: fadeInUp .5s ease-out both; }
    .animate-pop { animation: pop .25s ease-out both; }
    @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(14px) } to { opacity: 1; transform: translateY(0) } }
    @keyframes pop { from { transform: scale(.98); opacity: .6 } to { transform: scale(1); opacity: 1 } }

    /* Invoice print */
    @media print {
      body * { visibility: hidden; }
      #printable-invoice, #printable-invoice * { visibility: visible; }
      #printable-invoice { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none !important; }
      .no-print { display: none !important; }
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-900 overflow-x-hidden">
  <!-- Tailwind safelist (for dynamic classes) -->
  <div class="hidden">
    <div class="bg-gray-50 border-gray-200 text-gray-800"></div>
    <div class="bg-blue-50 border-blue-200 text-blue-800"></div>
    <div class="bg-yellow-50 border-yellow-200 text-yellow-800"></div>
    <div class="bg-purple-50 border-purple-200 text-purple-800"></div>
    <div class="bg-green-50 border-green-200 text-green-800"></div>
    <div class="bg-green-500 bg-blue-500 bg-yellow-500 bg-purple-500 bg-gray-500"></div>
  </div>

  <!-- Live Ticker -->
  <div id="liveTicker" class="bg-black text-white text-xs py-2 px-4 flex items-center justify-center gap-2 overflow-hidden whitespace-nowrap z-50 relative">
    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
    <span id="tickerMsg" class="font-mono font-bold tracking-wide animate-fade-in-up">Sola just earned â‚¦2,500 comm...</span>
  </div>

  <!-- App Root -->
  <div id="app"></div>

  <!-- Invoice Modal Root -->
  <div id="modalRoot"></div>

  <script>
    // -----------------------------
    // Constants & Mock Data
    // -----------------------------
    const TIERS = {
      standard: { name: 'Standard', depth: 2, price: 0, color: 'gray', theme: { bg: 'bg-gray-50', border: 'border-gray-200', text: 'text-gray-800', dot: 'bg-gray-500' } },
      silver:   { name: 'Silver',   depth: 3, price: 5000, color: 'blue', theme: { bg: 'bg-blue-50', border: 'border-blue-200', text: 'text-blue-800', dot: 'bg-blue-500' } },
      gold:     { name: 'Gold',     depth: 5, price: 20000, color: 'yellow', theme: { bg: 'bg-yellow-50', border: 'border-yellow-200', text: 'text-yellow-800', dot: 'bg-yellow-500' } },
      diamond:  { name: 'Diamond',  depth: 9, price: 100000, color: 'purple', theme: { bg: 'bg-purple-50', border: 'border-purple-200', text: 'text-purple-800', dot: 'bg-purple-500' } }
    };

    const MOCK_USER_PROFILE = {
      uid: 'user-root',
      fullName: 'Emeka Printer',
      phone: '08012345678',
      bankName: 'GTBank',
      accountNumber: '0123456789',
      myCode: 'EMEK88',
      referredBy: 'upl-001',
      walletBalance: 125500,
      networkEarnings: 45500,
      jobProfits: 80000,
      totalJobs: 12,
      jobsThisMonth: 2,
      membershipTier: 'standard',
      networkCount: 32,
      createdAt: { seconds: Date.now() / 1000 }
    };

    const MOCK_BUSINESSES = [
      { id: 'biz-1', name: 'Morg Plaza Global Prints', location: 'Area 10' },
      { id: 'biz-2', name: 'UTC Area 10 Graphics', location: 'Garki' },
      { id: 'biz-3', name: 'Shomolu Standard Press', location: 'Lagos/Abuja' },
      { id: 'biz-4', name: 'Banex Digital Hub', location: 'Wuse 2' },
      { id: 'biz-5', name: 'Emeka & Sons Large Format', location: 'Gwagwalada' }
    ];

    const JOB_TYPES = [
      'Flex Banner (Large)', 'SAV Sticker', 'Flyers (1000pcs)', 'Business Cards',
      'Letterhead', 'Direct Image (DI)', 'Vehicle Branding', 'T-Shirt Heat Transfer',
      'Monogram / Embroidery', 'Roll-up Banner', 'Wedding IVs', 'Custom'
    ];

    // -----------------------------
    // State
    // -----------------------------
    const state = {
      view: 'landing',            // landing | auth | dashboard | new-job | network | wallet | payment-success
      isRegistering: false,
      loading: false,
      user: null,
      userData: null,
      authForm: {
        fullName: '', phone: '', bankName: '', accountNumber: '',
        pin: '', referralCode: '', email: '', password: ''
      },
      jobs: [],
      pendingJob: null,
      showInvoice: false,
      withdrawalMsg: null,
      binaryTree: null
    };

    // -----------------------------
    // Helpers
    // -----------------------------
    const el = (id) => document.getElementById(id);
    const fmt = (n) => (Number(n) || 0).toLocaleString();
    const tier = () => TIERS[state.userData?.membershipTier || 'standard'];
    const nowSec = () => Math.floor(Date.now()/1000);

    function toast(type, text) {
      state.withdrawalMsg = { type, text };
      render();
      setTimeout(() => { state.withdrawalMsg = null; render(); }, 4000);
    }

    // Recursive generation of network data
    function generateNetworkTree(depth, currentId = "root") {
      if (depth === 0) return null;
      return {
        id: currentId,
        name: currentId === "root" ? "You" : `Agnt-${currentId.substring(0,3)}`,
        sales: Math.floor(Math.random() * 50000),
        left: Math.random() > 0.1 ? generateNetworkTree(depth - 1, `${currentId}L`) : null,
        right: Math.random() > 0.2 ? generateNetworkTree(depth - 1, `${currentId}R`) : null
      };
    }

    function icon(name, cls="w-5 h-5") {
      return `<i data-lucide="${name}" class="${cls}"></i>`;
    }

    function setView(v) {
      state.view = v;
      render();
    }

    // -----------------------------
    // Live Ticker
    // -----------------------------
    (function initTicker() {
      const messages = [
        "ðŸ”¥ Musa in Area 10 just withdrew â‚¦45,000",
        "ðŸš€ New Gold Member: Chioma from Wuse 2",
        "ðŸ’¸ 1000 Flyers job completed - â‚¦8,000 Profit Paid",
        "âš ï¸ Only 3 Diamond slots left for Abuja this month",
        "âœ… Instant Payouts are active for GTB and Zenith"
      ];
      let i = 0;
      setInterval(() => {
        i = (i + 1) % messages.length;
        const node = el('tickerMsg');
        if (!node) return;
        node.classList.remove('animate-fade-in-up');
        void node.offsetWidth;
        node.textContent = messages[i];
        node.classList.add('animate-fade-in-up');
      }, 4000);
    })();

    // -----------------------------
    // Auth (Mock)
    // -----------------------------
    function handleAuthSubmit(e) {
      e.preventDefault();
      if (state.loading) return;
      state.loading = true;
      render();

      setTimeout(() => {
        const mockUid = state.isRegistering ? `user-${Math.floor(Math.random()*1000)}` : 'user-root';
        state.user = { uid: mockUid, email: state.authForm.email || 'user@yesprint.com' };

        state.userData = state.isRegistering ? {
          ...MOCK_USER_PROFILE,
          uid: mockUid,
          fullName: state.authForm.fullName,
          phone: state.authForm.phone,
          bankName: state.authForm.bankName,
          accountNumber: state.authForm.accountNumber,
          walletBalance: 0,
          networkEarnings: 0,
          jobProfits: 0,
          jobsThisMonth: 0,
          totalJobs: 0,
          myCode: (state.authForm.fullName.substring(0, 3) + Math.floor(1000 + Math.random() * 9000)).toUpperCase(),
          membershipTier: 'standard'
        } : { ...MOCK_USER_PROFILE };

        state.jobs = state.isRegistering ? [] : [
          { id: 'INV-1111', jobTitle: 'Mock Banner', businessName: 'Morg Plaza', amount: 50000, agentProfit: 5000, status: 'Completed', createdAt: { seconds: nowSec() } }
        ];

        state.binaryTree = generateNetworkTree(5);
        state.loading = false;
        state.view = 'dashboard';
        render();
      }, 1200);
    }

    function updateAuthForm(name, value) {
      state.authForm[name] = value;
    }

    // -----------------------------
    // Job Flow
    // -----------------------------
    function generateInvoiceFromForm(form) {
      const costPrice = parseFloat(form.costPrice.value || '0');
      const margin = parseFloat(form.margin.value || '0');
      const totalAmount = costPrice + margin;

      const businessId = form.businessId.value;
      const business = MOCK_BUSINESSES.find(b => b.id === businessId);

      const jobData = {
        id: `INV-${Date.now()}`,
        businessId,
        businessName: business ? business.name : 'Unknown',
        jobTitle: form.jobTitle.value,
        jobType: form.jobType.value,
        costPrice,
        margin,
        amount: totalAmount,
        agentProfit: 0,
        status: 'Pending',
        createdAt: { seconds: nowSec() }
      };

      state.jobs = [jobData, ...state.jobs];
      state.pendingJob = jobData;
      state.showInvoice = true;
      render();
    }

    function confirmJobPayment(jobId) {
      const idx = state.jobs.findIndex(j => j.id === jobId);
      if (idx === -1) return;
      const job = state.jobs[idx];
      if (job.status === 'Completed') return;

      const networkDeduction = job.margin * 0.20;
      const agentNetProfit = job.margin - networkDeduction;

      state.jobs[idx] = {
        ...job,
        agentProfit: agentNetProfit,
        networkFee: networkDeduction,
        status: 'Completed'
      };

      state.userData = {
        ...state.userData,
        walletBalance: (state.userData.walletBalance || 0) + agentNetProfit,
        jobProfits: (state.userData.jobProfits || 0) + agentNetProfit,
        totalJobs: (state.userData.totalJobs || 0) + 1,
        jobsThisMonth: (state.userData.jobsThisMonth || 0) + 1
      };

      if (state.pendingJob && state.pendingJob.id === jobId) {
        state.pendingJob = null;
        state.showInvoice = false;
        state.view = 'payment-success';
      }
      render();
    }

    function handleWithdrawalRequest() {
      if ((state.userData?.jobsThisMonth || 0) < 4) {
        toast('error', `You need 4 jobs this month to withdraw. You have only done ${state.userData.jobsThisMonth}.`);
      } else {
        toast('success', 'Withdrawal request sent to admin! Crediting GTBank ending 6789...');
      }
    }

    // -----------------------------
    // Invoice Modal
    // -----------------------------
    function closeInvoice(goDashboardIfNewJob = false) {
      state.showInvoice = false;
      state.pendingJob = null;
      if (goDashboardIfNewJob && state.view === 'new-job') state.view = 'dashboard';
      render();
    }

    function copyText(text) {
      if (navigator.clipboard?.writeText) {
        navigator.clipboard.writeText(text).then(() => toast('success', 'Copied!'));
      } else {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        toast('success', 'Copied!');
      }
    }

    // -----------------------------
    // Render: Components
    // -----------------------------
    function Card(inner, extra="") {
      return `<div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 ${extra}">${inner}</div>`;
    }

    function Button(inner, opts={}) {
      const variant = opts.variant || 'primary';
      const type = opts.type || 'button';
      const disabled = !!opts.disabled;
      const id = opts.id || '';
      const cls = opts.className || '';

      const base = "px-6 py-3 rounded-xl font-bold transition-all duration-300 flex items-center justify-center gap-2 transform active:scale-95";
      const variants = {
        primary:  "bg-gradient-to-r from-green-600 to-green-500 text-white hover:shadow-lg hover:shadow-green-200 hover:-translate-y-0.5",
        secondary:"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-green-200",
        outline:  "border-2 border-green-600 text-green-600 hover:bg-green-50",
        danger:   "bg-red-50 text-red-600 hover:bg-red-100",
        cta:      "bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-xl shadow-orange-200 hover:shadow-2xl hover:-translate-y-1 text-lg",
        black:    "bg-gray-900 text-white hover:bg-black shadow-lg"
      };

      return `
        <button ${id ? `id="${id}"` : ''} type="${type}" ${disabled ? 'disabled' : ''}
          class="${base} ${variants[variant]} ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${cls}">
          ${inner}
        </button>
      `;
    }

    // Tree rendering (static HTML)
    function renderTreeNode(node, level, maxDepth) {
      if (!node) {
        if (level < 2) {
          return `
            <div class="flex flex-col items-center mx-2 opacity-30">
              <div class="w-8 h-8 rounded-full border border-dashed border-gray-400"></div>
            </div>`;
        }
        return '';
      }

      const isLocked = level > maxDepth;
      const isRoot = level === 0;

      const nodeSize = isRoot ? 'w-16 h-16 border-4 mb-4' : 'w-10 h-10 border-2 mb-2';
      const nodeColor = isLocked ? 'bg-gray-200 border-gray-300' : 'bg-white border-green-500';
      const textColor = isLocked ? 'text-gray-400' : 'text-gray-700';

      const badge = (!isRoot && !isLocked)
        ? `<div class="absolute -bottom-1 -right-1 bg-green-100 text-green-800 text-[8px] px-1 rounded-full font-bold border border-green-200">â‚¦${Math.floor(node.sales/1000)}k</div>`
        : '';

      const rootTag = isRoot
        ? `<div class="absolute top-16 bg-green-600 text-white text-[10px] px-2 py-0.5 rounded-full z-20">You</div>`
        : '';

      const centerIconOrText = isLocked
        ? `<span class="text-gray-400">${icon('lock', 'w-4 h-4')}</span>`
        : `<span class="font-bold ${textColor} ${isRoot ? 'text-lg' : 'text-xs'}">${(node.name || '').substring(0,1)}</span>`;

      const hasChildren = !!(node.left || node.right);

      const connectors = hasChildren ? `
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-2 flex justify-center">
          <div class="w-px h-full bg-gray-300 absolute top-0"></div>
          <div class="w-[80%] h-px bg-gray-300 absolute top-2"></div>
        </div>` : '';

      const leftLine = node.left ? `<div class="h-2 w-px bg-gray-300 mb-0"></div>` : '';
      const rightLine = node.right ? `<div class="h-2 w-px bg-gray-300 mb-0"></div>` : '';
      const gap = (node.left && node.right) ? `<div class="w-2 md:w-6"></div>` : '';

      return `
        <div class="flex flex-col items-center mx-1 relative">
          <div class="rounded-full border flex items-center justify-center shadow-md z-10 relative ${nodeSize} ${nodeColor}">
            ${centerIconOrText}
            ${badge}
          </div>
          ${rootTag}
          <div class="flex items-start justify-center pt-2 relative">
            ${connectors}
            <div class="flex flex-col items-center">
              ${leftLine}
              ${renderTreeNode(node.left, level+1, maxDepth)}
            </div>
            ${gap}
            <div class="flex flex-col items-center">
              ${rightLine}
              ${renderTreeNode(node.right, level+1, maxDepth)}
            </div>
          </div>
        </div>
      `;
    }

    // -----------------------------
    // Render: Pages
    // -----------------------------
    function renderLanding() {
      return `
        <div class="min-h-screen bg-white font-sans text-gray-900 overflow-x-hidden">
          <header class="sticky top-0 bg-white/90 backdrop-blur-md z-40 border-b border-gray-100">
            <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
              <div class="flex items-center gap-2">
                <div class="bg-green-600 p-1.5 rounded-lg">
                  ${icon('printer', 'text-white w-5 h-5')}
                </div>
                <span class="font-bold text-xl tracking-tight">YesPrint</span>
              </div>
              <div class="flex gap-3">
                <button id="btnLogin" class="text-sm font-semibold text-gray-600 hover:text-green-600">Log In</button>
                <button id="btnJoin" class="bg-black text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-800 transition-colors shadow-lg shadow-gray-200">Join Now</button>
              </div>
            </div>
          </header>

          <section class="pt-16 pb-20 px-4 max-w-5xl mx-auto text-center relative">
            <div class="absolute top-0 left-10 w-20 h-20 bg-yellow-400 rounded-full blur-3xl opacity-20 animate-pulse"></div>
            <div class="absolute bottom-0 right-10 w-32 h-32 bg-green-400 rounded-full blur-3xl opacity-20"></div>

            <div class="inline-flex items-center gap-2 bg-red-50 text-red-600 px-4 py-1.5 rounded-full text-sm font-bold mb-6 border border-red-100 animate-bounce">
              ${icon('zap', 'w-4 h-4')}
              <span>Warning: 14 Early Bird Slots Remaining</span>
            </div>

            <h1 class="text-5xl md:text-7xl font-extrabold tracking-tight text-gray-900 mb-6 leading-tight">
              The "Uber" for Printing <br/> is Finally Here.
            </h1>
            <p class="text-xl text-gray-500 mb-10 max-w-2xl mx-auto">
              Don't own a machine? No problem. Connect jobs to our network of printers. Set your own profit margin. Earn commissions with a network engine.
            </p>

            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
              ${Button(`${'Start Earning Today'} ${icon('arrow-right','w-6 h-6')}`, { variant:'cta', id:'btnStart', className:'w-full sm:w-auto px-10 py-5 text-xl' })}
            </div>
            <p class="mt-4 text-xs text-gray-400">Join agents and printers across Abuja, Lagos & PH</p>
          </section>

          <section class="bg-gray-900 text-white py-16">
            <div class="max-w-6xl mx-auto px-4">
              <div class="grid md:grid-cols-3 gap-8 text-center">
                <div class="p-6 border border-gray-800 rounded-2xl">
                  <h3 class="text-4xl font-black text-green-400 mb-2">â‚¦150M+</h3>
                  <p class="text-gray-400">Payouts Processed</p>
                </div>
                <div class="p-6 border border-gray-800 rounded-2xl">
                  <h3 class="text-4xl font-black text-blue-400 mb-2">9 Levels</h3>
                  <p class="text-gray-400">Deep Network Earnings</p>
                </div>
                <div class="p-6 border border-gray-800 rounded-2xl">
                  <h3 class="text-4xl font-black text-yellow-400 mb-2">24/7</h3>
                  <p class="text-gray-400">Instant Withdrawal</p>
                </div>
              </div>
            </div>
          </section>

          <section class="py-20 px-4 max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold text-center mb-4">Choose Your Earning Power</h2>
            <p class="text-center text-gray-500 mb-12">Upgrade anytime to unlock deeper commission levels.</p>

            <div class="grid md:grid-cols-4 gap-6">
              <div class="border border-gray-200 rounded-2xl p-6 hover:shadow-xl transition-shadow relative">
                <h3 class="text-xl font-bold text-gray-800">Standard</h3>
                <p class="text-3xl font-black mt-2">Free</p>
                <p class="text-sm text-gray-400 mb-6">Forever</p>
                <ul class="space-y-3 mb-0 text-sm">
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-green-500')} <b>2 Levels</b> Depth</li>
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-green-500')} Basic Support</li>
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-green-500')} Instant Payouts</li>
                </ul>
              </div>

              <div class="border border-blue-200 bg-blue-50 rounded-2xl p-6 hover:shadow-xl transition-shadow relative transform md:-translate-y-4">
                <div class="absolute top-0 right-0 bg-blue-600 text-white text-xs px-2 py-1 rounded-bl-lg font-bold">POPULAR</div>
                <h3 class="text-xl font-bold text-blue-800">Silver</h3>
                <p class="text-3xl font-black mt-2 text-blue-900">â‚¦5,000</p>
                <p class="text-sm text-blue-600 mb-6">/ month</p>
                <ul class="space-y-3 mb-0 text-sm">
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-blue-600')} <b>3 Levels</b> Depth</li>
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-blue-600')} Priority Support</li>
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-blue-600')} Invoice Customization</li>
                </ul>
              </div>

              <div class="border border-yellow-200 bg-yellow-50 rounded-2xl p-6 hover:shadow-xl transition-shadow relative">
                <h3 class="text-xl font-bold text-yellow-800">Gold</h3>
                <p class="text-3xl font-black mt-2 text-yellow-900">â‚¦20,000</p>
                <p class="text-sm text-yellow-600 mb-6">/ month</p>
                <ul class="space-y-3 mb-0 text-sm">
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-yellow-600')} <b>5 Levels</b> Depth</li>
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-yellow-600')} Dedicated Manager</li>
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-yellow-600')} Bulk Job Tools</li>
                </ul>
              </div>

              <div class="border border-purple-200 bg-purple-50 rounded-2xl p-6 hover:shadow-xl transition-shadow relative">
                <h3 class="text-xl font-bold text-purple-800 flex items-center gap-2">${icon('gem','w-4 h-4')} Diamond</h3>
                <p class="text-3xl font-black mt-2 text-purple-900">â‚¦100,000</p>
                <p class="text-sm text-purple-600 mb-6">/ month</p>
                <ul class="space-y-3 mb-0 text-sm">
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-purple-600')} <b>9 Levels</b> Depth</li>
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-purple-600')} 0% Withdrawal Fee</li>
                  <li class="flex gap-2">${icon('check-circle','w-4 h-4 text-purple-600')} Exclusive Events</li>
                </ul>
              </div>
            </div>
          </section>

          <footer class="bg-gray-50 border-t border-gray-200 py-10 text-center text-gray-500 text-sm">
            <p>Â© 2025 YesPrint Digital. Building the future of Nigerian Printing.</p>
          </footer>
        </div>
      `;
    }

    function renderAuth() {
      const title = state.isRegistering ? 'Join the Network' : 'Welcome Back';
      return `
        <div class="min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4 relative">
          <button id="btnBackToHome"
            class="absolute top-4 left-4 text-gray-400 hover:text-gray-600 flex items-center gap-1 text-sm font-medium">
            ${icon('chevron-right','w-4 h-4 rotate-180')} Back to Home
          </button>

          <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md animate-fade-in-up my-10">
            <div class="text-center mb-6">
              <h1 class="text-2xl font-bold text-gray-800">${title}</h1>
            </div>

            <form id="authForm" class="space-y-3">
              ${
                state.isRegistering ? `
                  <input name="fullName" type="text" required placeholder="Full Name"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />

                  <input name="phone" type="tel" required placeholder="Phone Number"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />

                  <div class="grid grid-cols-2 gap-2">
                    <input name="bankName" type="text" required placeholder="Bank Name"
                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />
                    <input name="accountNumber" type="text" required placeholder="Account No"
                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />
                  </div>

                  <div class="grid grid-cols-2 gap-2">
                    <input name="pin" type="password" required maxlength="4" placeholder="4-Digit PIN"
                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />
                    <input name="referralCode" type="text" required placeholder="Referral Code"
                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />
                  </div>

                  <input name="email" type="email" placeholder="Email (Optional)"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />
                ` : `
                  <input name="email" type="email" required placeholder="Email Address"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />
                `
              }

              <input name="password" type="password" required placeholder="${state.isRegistering ? 'Create Password' : 'Password'}"
                class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />

              ${Button(state.loading ? 'Processing...' : (state.isRegistering ? 'Create Agent Account' : 'Login'), {
                variant: 'primary',
                type: 'submit',
                disabled: state.loading,
                className: 'w-full shadow-lg shadow-green-200'
              })}

            </form>

            <div class="mt-4 text-center">
              <button id="btnToggleAuth" class="text-green-600 font-bold text-sm">
                ${state.isRegistering ? 'Already have an account? Login' : 'New Agent? Register Here'}
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderTopNav() {
      const t = tier();
      return `
        <div class="bg-white shadow-sm sticky top-0 z-30 px-4 py-3 flex justify-between items-center">
          <button id="navHome" class="flex items-center gap-2">
            <div class="bg-green-600 p-1.5 rounded-lg">
              ${icon('printer','text-white w-5 h-5')}
            </div>
            <span class="font-bold text-gray-800 text-lg hidden sm:block">YesPrint</span>
          </button>

          <div class="flex items-center gap-3">
            <div class="flex flex-col items-end mr-2">
              <span class="text-sm font-bold text-gray-800">${state.userData?.fullName || ''}</span>
              <div class="flex items-center gap-1">
                <span class="w-2 h-2 rounded-full ${t.theme.dot}"></span>
                <span class="text-xs text-gray-500 uppercase">${state.userData?.membershipTier || ''}</span>
              </div>
            </div>

            <button id="navWallet" class="bg-green-50 text-green-700 border border-green-100 px-3 py-1.5 rounded-full text-sm font-bold flex items-center gap-1">
              <span class="text-xs">â‚¦</span>${fmt(state.userData?.walletBalance)}
            </button>
          </div>
        </div>
      `;
    }

    function renderDashboard() {
      const t = tier();
      const themeBar = `${t.theme.bg} ${t.theme.border}`;
      const themeText = `${t.theme.text}`;
      const jobs = state.jobs || [];

      return `
        <div class="min-h-screen bg-gray-50 pb-20 md:pb-0">
          ${renderTopNav()}

          <div class="max-w-4xl mx-auto p-4">
            <div class="space-y-6 animate-fade-in">

              <div class="${themeBar} border p-4 rounded-xl flex items-center justify-between">
                <div>
                  <p class="${themeText} font-bold text-sm uppercase flex items-center gap-2">
                    ${icon('award','w-4 h-4')} Current Plan: ${t.name}
                  </p>
                  <p class="text-xs text-gray-500 mt-1">You earn commissions on ${t.depth} levels.</p>
                </div>
                ${state.userData?.membershipTier !== 'diamond'
                  ? `<button class="text-xs bg-black text-white px-3 py-2 rounded-lg font-bold">Upgrade</button>`
                  : ``
                }
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${Card(`
                  <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full -mr-10 -mt-10"></div>
                  <div class="relative z-10">
                    <p class="text-gray-400 text-xs uppercase tracking-wider font-medium mb-1">Total Balance</p>
                    <h2 class="text-4xl font-bold">â‚¦${fmt(state.userData?.walletBalance)}</h2>
                    <div class="mt-4 flex gap-2">
                      <div class="bg-white/10 px-2 py-1 rounded text-xs">Active: â‚¦${fmt(state.userData?.jobProfits)}</div>
                      <div class="bg-green-500/20 px-2 py-1 rounded text-xs text-green-300">Passive: â‚¦${fmt(state.userData?.networkEarnings)}</div>
                    </div>
                  </div>
                `, 'bg-gradient-to-br from-gray-900 to-gray-800 text-white border-none relative overflow-hidden')}

                <div class="grid grid-cols-2 gap-4">
                  ${Card(`
                    <div class="flex justify-between items-start">
                      <div class="p-2 bg-blue-50 rounded-lg">${icon('git-merge','text-blue-600 w-5 h-5')}</div>
                    </div>
                    <div>
                      <p class="text-2xl font-bold text-gray-800 mt-2">${state.userData?.networkCount || 0}</p>
                      <p class="text-gray-500 text-xs">Team Members</p>
                    </div>
                  `, 'p-4 flex flex-col justify-between cursor-pointer hover:border-green-300')}
                  ${Card(`
                    <div class="flex justify-between items-start">
                      <div class="p-2 bg-orange-50 rounded-lg">${icon('briefcase','text-orange-600 w-5 h-5')}</div>
                    </div>
                    <div>
                      <p class="text-2xl font-bold text-gray-800 mt-2">${state.userData?.jobsThisMonth || 0} <span class="text-xs text-gray-400 font-normal">/ 4</span></p>
                      <p class="text-gray-500 text-xs">Jobs This Month</p>
                    </div>
                  `, 'p-4 flex flex-col justify-between')}
                </div>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                ${Button(`${icon('plus-circle','w-6 h-6')} Submit Job`, { id:'btnToNewJob', className:'py-4 text-lg shadow-lg shadow-green-100' })}
                ${Button(`${icon('user-plus','w-6 h-6 text-gray-600')} My Network`, { variant:'secondary', id:'btnToNetwork', className:'py-4 text-lg' })}
              </div>

              <div>
                <h3 class="font-bold text-gray-800 mb-4">Job History & Status</h3>
                <div class="space-y-3">
                  ${jobs.length === 0 ? `<p class="text-gray-400 text-sm text-center py-8">No recent jobs found.</p>` : ''}
                  ${jobs.slice(0,5).map(job => {
                    const isPending = job.status === 'Pending';
                    return `
                      <div class="bg-white p-4 rounded-xl border border-gray-100 flex flex-col sm:flex-row justify-between items-center shadow-sm gap-4">
                        <div class="flex items-center gap-4 w-full sm:w-auto">
                          <div class="p-3 rounded-xl ${isPending ? 'bg-yellow-100' : 'bg-green-100'}">
                            ${isPending ? icon('clock','w-5 h-5 text-yellow-600') : icon('check-circle','w-5 h-5 text-green-600')}
                          </div>
                          <div>
                            <p class="font-bold text-gray-800">${job.jobTitle}</p>
                            <p class="text-xs text-gray-500">${job.businessName} â€¢ ${job.status}</p>
                          </div>
                        </div>

                        <div class="flex items-center gap-3 w-full sm:w-auto justify-end">
                          <div class="text-right">
                            <p class="font-bold text-gray-800">â‚¦${fmt(job.amount)}</p>
                            ${!isPending ? `
                              <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                + â‚¦${fmt(job.agentProfit)}
                              </span>` : ''
                            }
                          </div>

                          ${
                            isPending ? `
                              <div class="flex gap-2">
                                <button data-open-invoice="${job.id}"
                                  class="bg-gray-100 text-gray-600 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-gray-200">
                                  Invoice
                                </button>
                                <button data-confirm-job="${job.id}"
                                  class="bg-green-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-green-700 shadow-sm">
                                  Confirm
                                </button>
                              </div>
                            ` : `
                              <button data-open-invoice="${job.id}" class="text-gray-400 hover:text-gray-600">
                                ${icon('file-text','w-5 h-5')}
                              </button>
                            `
                          }
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>

            </div>
          </div>

          ${renderBottomNav()}
        </div>
      `;
    }

    function renderNewJob() {
      return `
        <div class="min-h-screen bg-gray-50 pb-20 md:pb-0">
          ${renderTopNav()}

          <div class="max-w-4xl mx-auto p-4">
            <div class="animate-fade-in max-w-2xl mx-auto">
              <div class="flex items-center gap-2 mb-6">
                <button id="btnBackDash1" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                  ${icon('chevron-right','w-5 h-5 rotate-180')}
                </button>
                <h2 class="text-xl font-bold text-gray-800">New Print Job</h2>
              </div>

              ${Card(`
                <form id="jobForm" class="space-y-6">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Printing Business</label>
                    <select name="businessId" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 outline-none bg-white">
                      <option value="">-- Choose Business --</option>
                      ${MOCK_BUSINESSES.map(b => `<option value="${b.id}">${b.name} (${b.location})</option>`).join('')}
                    </select>
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Job Description</label>
                    <input name="jobTitle" required type="text" placeholder="e.g. Redeemed Church Banner"
                      class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" />
                  </div>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select name="jobType" required class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 outline-none bg-white">
                      ${JOB_TYPES.map(t => `<option value="${t}">${t}</option>`).join('')}
                    </select>
                  </div>

                  <div class="grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <div>
                      <label class="block text-xs font-bold text-gray-500 mb-1 uppercase">Printer's Cost</label>
                      <div class="relative">
                        <span class="absolute left-3 top-2.5 text-gray-400">â‚¦</span>
                        <input name="costPrice" required type="number" placeholder="0"
                          class="w-full pl-6 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none" />
                      </div>
                    </div>
                    <div>
                      <label class="block text-xs font-bold text-green-600 mb-1 uppercase">Your Profit</label>
                      <div class="relative">
                        <span class="absolute left-3 top-2.5 text-gray-400">â‚¦</span>
                        <input name="margin" required type="number" placeholder="0"
                          class="w-full pl-6 pr-3 py-2 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none" />
                      </div>
                    </div>
                  </div>

                  ${Button(`${icon('download','w-5 h-5')} Generate Invoice`, { type:'submit', className:'w-full py-4 text-lg shadow-xl shadow-green-100' })}
                </form>
              `, 'border-t-4 border-t-green-500')}
            </div>
          </div>

          ${renderBottomNav()}
        </div>
      `;
    }

    function renderPaymentSuccess() {
      return `
        <div class="min-h-screen bg-gray-50 pb-20 md:pb-0">
          ${renderTopNav()}
          <div class="max-w-4xl mx-auto p-4">
            <div class="animate-fade-in max-w-md mx-auto text-center pt-10">
              <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                ${icon('check-circle','w-12 h-12 text-green-600')}
              </div>
              <h2 class="text-3xl font-bold text-gray-800 mb-2">Success!</h2>
              <p class="text-gray-600 mb-8">Commission credited.</p>
              ${Button('Back to Dashboard', { id:'btnBackDash2' })}
            </div>
          </div>
          ${renderBottomNav()}
        </div>
      `;
    }

    function renderNetwork() {
      const t = tier();
      const treeHtml = renderTreeNode(state.binaryTree, 0, t.depth);

      return `
        <div class="min-h-screen bg-gray-50 pb-20 md:pb-0">
          ${renderTopNav()}

          <div class="max-w-4xl mx-auto p-4">
            <div class="animate-fade-in">
              <div class="flex items-center gap-2 mb-6">
                <button id="btnBackDash3" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                  ${icon('chevron-right','w-5 h-5 rotate-180')}
                </button>
                <h2 class="text-xl font-bold text-gray-800">My Network</h2>
              </div>

              ${Card(`
                <p class="text-blue-100 text-sm mb-1 font-medium">Unlocked Depth</p>
                <h1 class="text-4xl font-black mb-2">${t.depth} Levels</h1>
                <p class="text-xs text-blue-200">Current Plan: ${t.name}</p>
              `, 'bg-gradient-to-r from-blue-600 to-blue-500 text-white border-none mb-8')}

              <div class="bg-gray-50 rounded-2xl border border-gray-200 p-2 mb-8 overflow-auto min-h-[400px] flex justify-center relative shadow-inner">
                <div class="min-w-[600px] flex justify-center pt-4">
                  ${treeHtml}
                </div>
              </div>
            </div>
          </div>

          ${renderBottomNav()}
        </div>
      `;
    }

    function renderWallet() {
      const jobsThisMonth = state.userData?.jobsThisMonth || 0;
      const locked = jobsThisMonth < 4;

      const msg = state.withdrawalMsg;
      const msgBox = msg ? `
        <div class="p-4 rounded-xl mb-4 ${msg.type === 'error' ? 'bg-red-50 text-red-700' : 'bg-green-50 text-green-700'} flex items-center gap-2">
          ${msg.type === 'error' ? icon('alert-triangle','w-5 h-5') : icon('check-circle','w-5 h-5')}
          ${msg.text}
        </div>` : '';

      return `
        <div class="min-h-screen bg-gray-50 pb-20 md:pb-0">
          ${renderTopNav()}

          <div class="max-w-4xl mx-auto p-4">
            <div class="animate-fade-in">
              <div class="flex items-center gap-2 mb-6">
                <button id="btnBackDash4" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                  ${icon('chevron-right','w-5 h-5 rotate-180')}
                </button>
                <h2 class="text-xl font-bold text-gray-800">Wallet</h2>
              </div>

              ${msgBox}

              <div class="grid grid-cols-2 gap-4 mb-6">
                ${Card(`
                  <div class="flex items-center gap-2 mb-2">
                    ${icon('briefcase','w-4 h-4 text-blue-500')}
                    <p class="text-gray-500 text-xs uppercase font-bold">Active Job Profits</p>
                  </div>
                  <h3 class="text-xl font-bold text-gray-800">â‚¦${fmt(state.userData?.jobProfits)}</h3>
                  <p class="text-[10px] text-gray-400 mt-1">From your direct clients</p>
                `, 'bg-white border-l-4 border-l-blue-500 shadow-md')}

                ${Card(`
                  <div class="flex items-center gap-2 mb-2">
                    ${icon('git-merge','w-4 h-4 text-green-500')}
                    <p class="text-gray-500 text-xs uppercase font-bold">Network Earnings</p>
                  </div>
                  <h3 class="text-xl font-bold text-gray-800">â‚¦${fmt(state.userData?.networkEarnings)}</h3>
                  <p class="text-[10px] text-gray-400 mt-1">Passive from downlines</p>
                `, 'bg-white border-l-4 border-l-green-500 shadow-md')}
              </div>

              ${Card(`
                <h1 class="text-5xl font-black text-gray-900 mb-2">â‚¦${fmt(state.userData?.walletBalance)}</h1>
                <p class="text-gray-500 text-xs uppercase tracking-wider mb-8">Total Withdrawable Balance</p>

                <div class="bg-white p-4 rounded-xl border border-gray-200 mb-6 text-left max-w-sm mx-auto">
                  <p class="text-xs text-gray-400 mb-1">Bank Payout To:</p>
                  <p class="font-bold text-gray-800">${state.userData?.bankName || ''} - ${state.userData?.accountNumber || ''}</p>

                  <div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-100">
                    <span class="text-xs text-gray-500">Jobs this month: ${jobsThisMonth}/4</span>
                    ${locked ? icon('lock','w-3 h-3 text-red-400') : ''}
                  </div>

                  ${locked ? `
                    <div class="w-full bg-gray-200 h-1.5 rounded-full mt-2">
                      <div class="bg-green-500 h-1.5 rounded-full" style="width:${(jobsThisMonth/4)*100}%"></div>
                    </div>` : ''
                  }
                </div>

                <div class="flex flex-col sm:flex-row justify-center gap-4 max-w-md mx-auto">
                  ${Button('Request Withdrawal', { id:'btnWithdraw', disabled: locked, className:'w-full flex-1' })}
                </div>
              `, 'text-center py-8 mb-6 bg-gray-50 border-gray-200')}
            </div>
          </div>

          ${renderBottomNav()}
        </div>
      `;
    }

    function renderBottomNav() {
      // Only show in "app" views (not landing/auth)
      if (!['dashboard','new-job','network','wallet','payment-success'].includes(state.view)) return '';
      const active = (v) => state.view === v ? 'text-green-600 bg-green-50 scale-105' : 'text-gray-400 hover:bg-gray-50';
      return `
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-2 md:hidden grid grid-cols-4 gap-1 z-40 pb-safe">
          <button data-nav="dashboard" class="flex flex-col items-center justify-center p-2 rounded-xl transition-all ${active('dashboard')}">
            ${icon('printer','w-6 h-6')} <span class="text-[10px] font-bold mt-1">Home</span>
          </button>
          <button data-nav="new-job" class="flex flex-col items-center justify-center p-2 rounded-xl transition-all ${active('new-job')}">
            ${icon('plus-circle','w-6 h-6')} <span class="text-[10px] font-bold mt-1">Submit</span>
          </button>
          <button data-nav="network" class="flex flex-col items-center justify-center p-2 rounded-xl transition-all ${active('network')}">
            ${icon('users','w-6 h-6')} <span class="text-[10px] font-bold mt-1">Network</span>
          </button>
          <button data-nav="wallet" class="flex flex-col items-center justify-center p-2 rounded-xl transition-all ${active('wallet')}">
            ${icon('wallet','w-6 h-6')} <span class="text-[10px] font-bold mt-1">Wallet</span>
          </button>
        </div>
      `;
    }

    function renderInvoiceModal() {
      if (!state.showInvoice || !state.pendingJob || !state.userData) return '';
      const job = state.pendingJob;
      const user = state.userData;

      const statusPill = job.status === 'Completed'
        ? 'bg-green-100 text-green-700'
        : 'bg-yellow-100 text-yellow-700';

      return `
        <div class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 overflow-y-auto animate-fade-in">
          <div class="bg-white w-full max-w-md rounded-xl overflow-hidden shadow-2xl" id="printable-invoice">
            <div class="bg-gray-900 text-white p-6 text-center">
              <div class="flex justify-center mb-2">
                <div class="bg-white p-2 rounded-lg">${icon('printer','text-gray-900 w-6 h-6')}</div>
              </div>
              <h2 class="text-xl font-bold uppercase tracking-widest">Payment Invoice</h2>
              <p class="text-gray-400 text-xs">YesPrint Digital Platform</p>
            </div>

            <div class="p-8 space-y-6">
              <div class="text-center">
                <p class="text-gray-500 text-xs uppercase">Pay To</p>
                <h3 class="text-lg font-bold text-gray-800">${job.businessName}</h3>
                <div class="inline-block px-3 py-1 rounded-full text-xs font-bold mt-2 ${statusPill}">
                  Status: ${job.status === 'Completed' ? 'PAID' : 'PENDING'}
                </div>
              </div>

              <div class="bg-green-50 border border-green-200 rounded-xl p-4 text-center">
                <p class="text-gray-500 text-xs uppercase mb-1">Total Amount Due</p>
                <h1 class="text-4xl font-black text-green-700">â‚¦${fmt(job.amount)}</h1>
              </div>

              <div class="border-t border-b border-gray-100 py-4 space-y-3">
                <div class="flex justify-between">
                  <span class="text-gray-500">Bank Name</span>
                  <span class="font-bold">Stanbic IBTC</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-gray-500">Account Number</span>
                  <div class="flex items-center gap-2">
                    <span class="font-mono text-xl font-bold tracking-wider">5770438727</span>
                    <button id="btnCopyAcct" class="text-gray-400 hover:text-gray-700" title="Copy account">
                      ${icon('copy','w-4 h-4')}
                    </button>
                  </div>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-500">Job Reference</span>
                  <span class="font-mono text-xs bg-gray-100 px-2 py-1 rounded">${String(job.id).substring(4, 12).toUpperCase()}</span>
                </div>
              </div>

              <div class="text-center text-xs text-gray-400">
                <p>Please make transfer immediately to avoid job cancellation.</p>
                <p class="mt-1">Generated by Agent: ${user.fullName}</p>
              </div>

              <div class="flex flex-col gap-3 no-print">
                ${
                  job.status !== 'Completed'
                  ? Button(`${icon('check-circle','w-4 h-4')} Confirm Payment & Mark Paid`, { id:'btnConfirmPay', className:'w-full bg-green-600 hover:bg-green-700' })
                  : ''
                }
                <div class="flex gap-3">
                  ${Button(`${icon('printer','w-4 h-4')} Print`, { variant:'secondary', id:'btnPrint', className:'flex-1' })}
                  ${Button(job.status === 'Completed' ? 'Close' : 'Save for Later', { variant:'outline', id:'btnCloseInvoice', className:'flex-1' })}
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // -----------------------------
    // Master Render
    // -----------------------------
    function render() {
      const root = el('app');
      const modalRoot = el('modalRoot');

      let html = '';
      if (state.view === 'landing') html = renderLanding();
      else if (state.view === 'auth') html = renderAuth();
      else if (state.view === 'dashboard') html = renderDashboard();
      else if (state.view === 'new-job') html = renderNewJob();
      else if (state.view === 'network') html = renderNetwork();
      else if (state.view === 'wallet') html = renderWallet();
      else if (state.view === 'payment-success') html = renderPaymentSuccess();
      else html = renderLanding();

      root.innerHTML = html;
      modalRoot.innerHTML = renderInvoiceModal();

      // Activate lucide icons after DOM updates
      if (window.lucide?.createIcons) window.lucide.createIcons();

      // Wire events
      bindEvents();
    }

    // -----------------------------
    // Event Binding (after render)
    // -----------------------------
    function bindEvents() {
      // Landing
      const btnJoin = el('btnJoin');
      const btnLogin = el('btnLogin');
      const btnStart = el('btnStart');
      if (btnJoin) btnJoin.onclick = () => { state.isRegistering = true; state.view = 'auth'; render(); };
      if (btnStart) btnStart.onclick = () => { state.isRegistering = true; state.view = 'auth'; render(); };
      if (btnLogin) btnLogin.onclick = () => { state.isRegistering = false; state.view = 'auth'; render(); };

      // Auth
      const btnBackToHome = el('btnBackToHome');
      const btnToggleAuth = el('btnToggleAuth');
      const authForm = el('authForm');
      if (btnBackToHome) btnBackToHome.onclick = () => setView('landing');
      if (btnToggleAuth) btnToggleAuth.onclick = () => { state.isRegistering = !state.isRegistering; render(); };
      if (authForm) {
        // Prefill current inputs (keep state if re-rendered)
        [...authForm.elements].forEach(inp => {
          if (!inp.name) return;
          if (state.authForm[inp.name] != null && inp.value === '') inp.value = state.authForm[inp.name];
          inp.oninput = (e) => updateAuthForm(inp.name, e.target.value);
        });
        authForm.onsubmit = handleAuthSubmit;
      }

      // Top Nav
      const navHome = el('navHome');
      const navWallet = el('navWallet');
      if (navHome) navHome.onclick = () => setView('dashboard');
      if (navWallet) navWallet.onclick = () => setView('wallet');

      // Dashboard buttons
      const btnToNewJob = el('btnToNewJob');
      const btnToNetwork = el('btnToNetwork');
      if (btnToNewJob) btnToNewJob.onclick = () => setView('new-job');
      if (btnToNetwork) btnToNetwork.onclick = () => setView('network');

      // Job list invoice/confirm buttons
      document.querySelectorAll('[data-open-invoice]').forEach(b => {
        b.onclick = () => {
          const id = b.getAttribute('data-open-invoice');
          const job = state.jobs.find(j => j.id === id);
          if (!job) return;
          state.pendingJob = job;
          state.showInvoice = true;
          render();
        };
      });

      document.querySelectorAll('[data-confirm-job]').forEach(b => {
        b.onclick = () => {
          const id = b.getAttribute('data-confirm-job');
          if (confirm("Confirming this payment means you have verified the transfer. Proceed?")) {
            confirmJobPayment(id);
          }
        };
      });

      // New Job
      const btnBackDash1 = el('btnBackDash1');
      const jobForm = el('jobForm');
      if (btnBackDash1) btnBackDash1.onclick = () => setView('dashboard');
      if (jobForm) {
        jobForm.onsubmit = (e) => {
          e.preventDefault();
          generateInvoiceFromForm(jobForm);
        };
      }

      // Network
      const btnBackDash3 = el('btnBackDash3');
      if (btnBackDash3) btnBackDash3.onclick = () => setView('dashboard');

      // Wallet
      const btnBackDash4 = el('btnBackDash4');
      const btnWithdraw = el('btnWithdraw');
      if (btnBackDash4) btnBackDash4.onclick = () => setView('dashboard');
      if (btnWithdraw) btnWithdraw.onclick = () => handleWithdrawalRequest();

      // Payment success
      const btnBackDash2 = el('btnBackDash2');
      if (btnBackDash2) btnBackDash2.onclick = () => setView('dashboard');

      // Bottom nav
      document.querySelectorAll('[data-nav]').forEach(b => {
        b.onclick = () => setView(b.getAttribute('data-nav'));
      });

      // Invoice modal actions
      const btnCloseInvoice = el('btnCloseInvoice');
      const btnConfirmPay = el('btnConfirmPay');
      const btnPrint = el('btnPrint');
      const btnCopyAcct = el('btnCopyAcct');

      if (btnCloseInvoice) btnCloseInvoice.onclick = () => closeInvoice(true);
      if (btnPrint) btnPrint.onclick = () => window.print();
      if (btnCopyAcct) btnCopyAcct.onclick = () => copyText('5770438727');

      if (btnConfirmPay) {
        btnConfirmPay.onclick = () => {
          if (!state.pendingJob) return;
          if (confirm("Confirming this payment means you have verified the transfer. Proceed?")) {
            confirmJobPayment(state.pendingJob.id);
          }
        };
      }
    }

    // -----------------------------
    // Boot
    // -----------------------------
    render();
  </script>
</body>
</html>

